# Лид-формы — План прототипа

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Цель:** Интерактивный прототип сервиса "Лид-формы" для МТС Маркетолог — полный флоу от списка форм до просмотра лидов.

**Архитектура:** Единое React-приложение внутри ProtoKit. Используем CabinetLayout (TopBar) как оболочку, внутренний роутинг через вложенные маршруты. Данные — моковые, хранятся в React state / context. Конструктор — полная интерактивность с drag-and-drop (dnd-kit).

**Tech Stack:** React 19, MUI 7, React Router 7, TypeScript, @dnd-kit/core + @dnd-kit/sortable, тема МТС (уже в проекте).

---

## Дополненные требования (по результатам брейншторма и демо)

### Что вошло в scope прототипа

| # | Требование | Источник |
|---|-----------|----------|
| 1 | Список форм — **карточки** (не таблица), 3-5 форм | Демо |
| 2 | Статусы формы: **Черновик / Активна / Неактивна** | Демо + интервью |
| 3 | На карточке: название, статус, кол-во лидов, % обзвоненных, дата создания | Спека + демо (аналитика встроена) |
| 4 | Конструктор: **3-колоночный лейаут** (библиотека полей / рабочая область / свойства) | Спека |
| 5 | Конструктор: **полная интерактивность** — drag-and-drop, добавление/удаление полей, редактирование свойств, live-превью | Интервью |
| 6 | Типы полей: текст, textarea, email, телефон, число, select, multi-select, radio, checkbox, дата | Спека |
| 7 | **Без загрузки файлов** в v1 | Демо (Иван) |
| 8 | **Без промокодов** | Интервью |
| 9 | Общие настройки формы: название, описание, цвет кнопки, текст кнопки, сообщение после отправки | Спека |
| 10 | **Автосохранение** в конструкторе (визуальная индикация) | Демо |
| 11 | Публикация: оферта + чекбокс согласия → получение ссылки | Спека |
| 12 | После публикации: **CTA "Запустить рекламу"** (плейсхолдер) | Демо |
| 13 | Публичная форма: **простая страница** (логотип МТС, заголовок, описание, изображение, поля, кнопка) | Интервью + демо |
| 14 | **Брендирование** — лид-форма в айдентике МТС | Демо (Иван) |
| 15 | Inbox лидов: **таблица** с фильтрами по статусу и дате, поиском | Спека |
| 16 | Карточка лида: **Drawer справа** (не отдельная страница) | Интервью |
| 17 | В drawer: все ответы, статус, комментарии, история | Спека |
| 18 | Экспорт: **кнопка "Скачать Excel"** (без модального окна настроек) | Интервью |
| 19 | Дублирование лидов на почту — **опция в настройках формы** | Демо (Юрий) |
| 20 | **Превью формы** в конструкторе — рабочая область = WYSIWYG | Демо |
| 21 | Точка входа: **сразу раздел Лид-формы** (TopBar с табами, но другие — заглушки) | Интервью |

### Что НЕ входит в scope прототипа

- Backend / API / база данных
- Аутентификация (предполагаем, что в ЛК)
- Привязка к реальным кампаниям (только статусы)
- Загрузка файлов
- Промокоды
- Модерация (только упоминание на этапе публикации)
- Уведомления (кроме опции "email для лидов")
- Реальный экспорт файлов (имитация)
- Мобильная адаптивность (desktop-first, но без фиксированных breakpoints)

### Карта экранов

```
Лид-формы (список форм) ──→ Конструктор формы ──→ Публикация (модальное окно)
       │                            │
       │                            └──→ Превью формы (публичная)
       │
       └──→ Лиды формы (таблица) ──→ Drawer с карточкой лида
```

### Моковые данные

Предзаполненные данные для демонстрации:

**Формы (3 шт.):**
1. "Заявка на консультацию" — Активна, 47 лидов, 68% обзвонено
2. "Подписка на рассылку" — Активна, 124 лида, 45% обзвонено
3. "Обратная связь" — Черновик, 0 лидов

**Лиды (10-15 шт.)** для формы "Заявка на консультацию":
- Разные статусы (новый / просмотрен / обзвонен)
- Разные даты (последние 30 дней)
- Реалистичные ФИО, телефоны, email

---

## План реализации

### Task 0: Подготовка инфраструктуры

**Файлы:**
- Create: `protokit/src/prototypes/lead-forms/meta.ts`
- Create: `protokit/src/prototypes/lead-forms/index.tsx` (entry point)
- Create: `protokit/src/prototypes/lead-forms/data/mock-data.ts` (моки)
- Create: `protokit/src/prototypes/lead-forms/types.ts` (типы)
- Create: `protokit/src/prototypes/lead-forms/context/FormsContext.tsx` (state management)
- Modify: `protokit/src/router.tsx` (добавить lead-forms как full-page route, аналогично shablony)

**Описание:**
- Создать структуру папок
- Определить TypeScript типы: `Form`, `FormField`, `Lead`, `LeadStatus`, `FormStatus`
- Создать моковые данные
- Настроить FormsContext (React Context + useReducer) для управления состоянием форм и лидов
- Зарегистрировать роут в router.tsx как full-page (без AppShell)
- Установить @dnd-kit/core и @dnd-kit/sortable

**Зависимости:** Нет (стартовая задача)

---

### Task 1: Каркас приложения + TopBar + навигация

**Файлы:**
- Create: `protokit/src/prototypes/lead-forms/components/LeadFormsLayout.tsx`
- Create: `protokit/src/prototypes/lead-forms/pages/FormListPage.tsx` (заглушка)
- Create: `protokit/src/prototypes/lead-forms/pages/FormBuilderPage.tsx` (заглушка)
- Create: `protokit/src/prototypes/lead-forms/pages/FormLeadsPage.tsx` (заглушка)
- Create: `protokit/src/prototypes/lead-forms/pages/FormPreviewPage.tsx` (заглушка)

**Описание:**
- LeadFormsLayout использует CabinetLayout/TopBar с табами: "Кампании" (заглушка), "Шаблоны" (заглушка), "Лид-формы" (активный)
- Внутренний роутинг: `/lead-forms` → список, `/lead-forms/new` → конструктор, `/lead-forms/:id/edit` → конструктор, `/lead-forms/:id/leads` → лиды, `/lead-forms/:id/preview` → превью
- Все страницы — заглушки с заголовками

**Зависимости:** Task 0

---

### Task 2: Страница списка форм (карточки)

**Файлы:**
- Modify: `protokit/src/prototypes/lead-forms/pages/FormListPage.tsx`
- Create: `protokit/src/prototypes/lead-forms/components/FormCard.tsx`

**Описание:**
- PageHeader: "Лид-формы" + кнопка "+ Создать форму"
- Сетка карточек (MUI Grid, 1-3 колонки)
- FormCard содержит:
  - Название формы
  - Chip со статусом (Черновик — серый, Активна — зелёный, Неактивна — оранжевый)
  - Метрики: кол-во лидов, % обзвоненных
  - Дата создания
  - Действия: "Редактировать", "Лиды", "Копировать ссылку", "Удалить"
- Клик "Создать форму" → выбор шаблона (Dialog с 3 вариантами + "С нуля") → переход в конструктор
- Клик "Редактировать" → конструктор
- Клик "Лиды" → страница лидов

**Зависимости:** Task 1

---

### Task 3: Конструктор форм — лейаут и библиотека полей

**Файлы:**
- Modify: `protokit/src/prototypes/lead-forms/pages/FormBuilderPage.tsx`
- Create: `protokit/src/prototypes/lead-forms/components/builder/FieldLibrary.tsx`
- Create: `protokit/src/prototypes/lead-forms/components/builder/FormCanvas.tsx`
- Create: `protokit/src/prototypes/lead-forms/components/builder/FieldProperties.tsx`
- Create: `protokit/src/prototypes/lead-forms/components/builder/BuilderToolbar.tsx`

**Описание:**
- 3-колоночный лейаут: сайдбар слева (240px) | рабочая область (flex) | панель свойств справа (300px)
- **FieldLibrary** (левый сайдбар):
  - Список доступных типов полей с иконками
  - Группировка: "Базовые" (текст, textarea, email, телефон, число), "Выбор" (select, multi-select, radio, checkbox), "Специальные" (дата)
  - Клик или drag добавляет поле в рабочую область
- **FormCanvas** (центр):
  - WYSIWYG-отображение формы
  - Drag-and-drop сортировка полей (dnd-kit)
  - Клик по полю → выделение → панель свойств справа
  - Кнопка удаления поля (при ховере)
- **FieldProperties** (правый сайдбар):
  - Появляется при выделении поля
  - Свойства: название поля, placeholder, обязательное (switch), описание
  - Для select/radio/checkbox: редактирование вариантов ответа
- **BuilderToolbar** (верхняя панель):
  - Название формы (редактируемое)
  - Индикатор автосохранения ("Сохранено" / "Сохранение...")
  - Кнопки: "Превью", "Опубликовать", "← Назад"

**Зависимости:** Task 1, Task 0 (dnd-kit)

---

### Task 4: Конструктор форм — общие настройки и публикация

**Файлы:**
- Create: `protokit/src/prototypes/lead-forms/components/builder/FormSettings.tsx`
- Create: `protokit/src/prototypes/lead-forms/components/PublishDialog.tsx`

**Описание:**
- **FormSettings** — секция в правом сайдбаре (когда поле не выбрано):
  - Название формы
  - Описание формы
  - Цвет кнопки (палитра МТС: красный, синий, зелёный, чёрный)
  - Текст кнопки отправки
  - Сообщение после отправки
  - Email для уведомлений о лидах (опционально)
- **PublishDialog** (модальное окно):
  - Проверка: есть ли хотя бы одно поле, есть ли обязательное поле
  - Текст оферты (placeholder)
  - Чекбокс согласия
  - Кнопка "Опубликовать" (disabled без чекбокса)
  - После публикации: ссылка (с кнопкой "Копировать"), кнопки "Посмотреть форму" и "Запустить рекламу" (CTA-заглушка)

**Зависимости:** Task 3

---

### Task 5: Публичная форма (превью)

**Файлы:**
- Modify: `protokit/src/prototypes/lead-forms/pages/FormPreviewPage.tsx`
- Create: `protokit/src/prototypes/lead-forms/components/PublicForm.tsx`

**Описание:**
- Полностраничный лейаут, стилизованный под МТС:
  - Фон: светло-серый
  - Карточка по центру (max-width 560px)
  - Логотип МТС вверху
  - Заголовок формы
  - Описание (если есть)
  - Поля формы (рендеринг по типам: TextField, Select, RadioGroup, CheckboxGroup, DatePicker)
  - Кнопка отправки (цвет из настроек)
  - Чекбокс "Согласие на обработку персональных данных"
- После отправки: сообщение об успехе (из настроек)
- Кнопка "Вернуться в конструктор" (видна только в режиме превью, не на "публичной" версии)

**Зависимости:** Task 3 (нужны типы и рендеринг полей)

---

### Task 6: Inbox лидов (таблица + фильтры)

**Файлы:**
- Modify: `protokit/src/prototypes/lead-forms/pages/FormLeadsPage.tsx`
- Create: `protokit/src/prototypes/lead-forms/components/leads/LeadsTable.tsx`
- Create: `protokit/src/prototypes/lead-forms/components/leads/LeadsFilters.tsx`
- Create: `protokit/src/prototypes/lead-forms/components/leads/LeadDrawer.tsx`

**Описание:**
- **Заголовок**: название формы + кнопки "Скачать Excel" и "← Назад к формам"
- **LeadsFilters** (над таблицей):
  - Фильтр по статусу: chips "Все" / "Новый" / "Просмотрен" / "Обзвонен"
  - Поиск по имени/телефону/email
  - Фильтр по дате (последние 7 / 30 дней / все)
- **LeadsTable** (MUI Table):
  - Колонки: чекбокс, дата, имя, контакт (телефон/email), статус (chip), превью ответов
  - Клик по строке → открывает LeadDrawer
  - Выделение строки при открытом drawer
- **LeadDrawer** (Drawer справа, 400px):
  - Все поля и ответы лида
  - Дата получения
  - Статус (select для смены)
  - Чекбокс "Обзвонен"
  - Комментарии (список + поле для нового)
  - Кнопка "Удалить лид"
- Кнопка "Скачать Excel" — snackbar "Файл скачан" (имитация)

**Зависимости:** Task 1, Task 0

---

## Порядок выполнения и параллелизация

```
Task 0 (инфраструктура)
  │
  ├──→ Task 1 (каркас + навигация)
  │      │
  │      ├──→ Task 2 (список форм) ──────────────────┐
  │      │                                             │
  │      ├──→ Task 3 (конструктор) ──→ Task 4 (настройки + публикация)
  │      │         │                                   │
  │      │         └──→ Task 5 (публичная форма)       │
  │      │                                             │
  │      └──→ Task 6 (лиды) ──────────────────────────┘
```

**Параллельные группы:**
- **Группа A (после Task 1):** Task 2 + Task 6 — независимые экраны
- **Группа B (после Task 3):** Task 4 + Task 5 — зависят от конструктора, но не друг от друга

**Общее время:** ~6 последовательных этапов при максимальной параллелизации.

---

## Контракт с субагентами

Каждый субагент получает:
1. Ссылку на этот план (секция соответствующего Task)
2. Контекст: структура ProtoKit, тема МТС, существующие компоненты
3. Файл типов `types.ts` и моков `mock-data.ts` (создаются в Task 0)
4. Ограничения: только `sx`-prop для стилей, импорты MUI по отдельности, цвета из темы, TypeScript strict

## Критерии готовности прототипа

- [ ] Список форм отображается с моковыми данными
- [ ] Конструктор позволяет добавлять, удалять, сортировать поля через drag-and-drop
- [ ] Свойства полей редактируются в правой панели
- [ ] Публикация показывает оферту и генерирует ссылку
- [ ] Публичная форма рендерит все типы полей
- [ ] Inbox показывает таблицу лидов с фильтрами
- [ ] Drawer открывает детали лида с возможностью смены статуса и добавления комментариев
- [ ] Навигация между всеми экранами работает
- [ ] Используется тема и палитра МТС
